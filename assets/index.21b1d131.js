var v=Object.defineProperty;var d=Object.getOwnPropertySymbols;var f=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable;var l=(n,t,e)=>t in n?v(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,m=(n,t)=>{for(var e in t||(t={}))f.call(t,e)&&l(n,e,t[e]);if(d)for(var e of d(t))b.call(t,e)&&l(n,e,t[e]);return n};var i=(n,t,e)=>(l(n,typeof t!="symbol"?t+"":t,e),e);const y=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}};y();class P{constructor(){i(this,"events",{})}subscribe(t,e){return this.events.hasOwnProperty(t)||(this.events[t]=[]),this.events[t].push(e)}publish(t,e={}){return this.events.hasOwnProperty(t)?this.events[t].map(r=>r(e)):[]}}class w{constructor(){i(this,"preventPublish",!1);i(this,"actions");i(this,"eventManager");i(this,"state");this.actions={},this.state={},this.eventManager=new P,this.setStateProxy()}setStateProxy(){const t=(e,r,s)=>(e[r]=s,this.preventPublish||this.eventManager.publish("stateChange",this.state),!0);this.state=new Proxy({},{set:t})}setState(t,e){this.preventPublish=!0,this.state[t]=e,this.preventPublish=!1}setAction(t,e){const r=s=>this.mergeState(e({state:m({},this.state),payload:s}));this.actions[t]=r}dispatch(t,e){if(!this.actions.hasOwnProperty(t))throw Error(`Invalid action type: ${t}.`);this.state=this.actions[t](e)}mergeState(t){return Object.assign(this.state,t)}getState(t){if(!this.state.hasOwnProperty(t))throw Error(`Invalid state key: ${t}.`);return this.state[t]}}class g{constructor({tagName:t,id:e,classNames:r}={}){i(this,"store");i(this,"container");i(this,"id");i(this,"classNames");this.id=e!=null?e:"",this.classNames=r!=null?r:[],this.container=this.createContainer(t!=null?t:"div"),this.store=new w,this.store.eventManager.subscribe("stateChange",()=>this.render())}createContainer(t){const e=document.createElement(t);return e.id=this.id,this.classNames.forEach(r=>{e.classList.add(r)}),e}removeAllChilds(){if(!!this.container)for(;this.container.firstChild;)this.container.removeChild(this.container.firstChild)}render(){throw Error("You must implement render method in component instance.")}}const p=()=>{throw Error("Please set view action to routes.")};class a{static setViewTo(t,e,r=document.getElementById("app")){const s=()=>{r&&(r.innerHTML=""),e()};this.INFO[t].view=s}static view(t){const{path:e}=this.splitProxyPath(t);if(!this.INFO.hasOwnProperty(e)){console.log(e),this.view404();return}this.INFO[e].view()}static splitProxyPath(t){let e="";const r=new RegExp("^\\/proxy\\/\\d+");for(;t.match(r);)e+=t.match(r)[0],t=t.replace(r,"");return{proxy:e,path:t}}static view404(){const t=document.getElementById("app");t.innerHTML="404 Page not found."}}i(a,"PROXY_ROOT_PATH",""),i(a,"INFO",{"/":{name:"home",view:p},"/signin":{name:"signin",view:p}});const c=class{constructor(t,e="click"){i(this,"targetRoute");this.target=t,this.targetRoute=this.getRouterDataFromElement(this.target),this.target.addEventListener(e,this.execute.bind(this)),this.addGlobalRouterEvents()}addGlobalRouterEvents(){c.globalEventSetted||(c.globalEventSetted=!0,window.addEventListener("popstate",this.renderViewWhenPopState.bind(this)),window.addEventListener("routetrigger",this.renderViewWhenRouteTriggered.bind(this)))}getRouterDataFromElement(t){const{route:e}=t.dataset;if(!e)throw Error("Router must be setted html attribute 'data-route'.");return e}execute(){const t=new CustomEvent("routetrigger",{composed:!0,detail:{href:this.targetRoute}});window.dispatchEvent(t)}renderViewWhenPopState(){a.view(window.location.pathname)}renderViewWhenRouteTriggered(t){const{href:e}=t.detail;window.history.pushState(null,"",`${a.PROXY_ROOT_PATH}${e}`),a.view(e)}};let h=c;i(h,"globalEventSetted",!1);class E{constructor(t){i(this,"globalStore");i(this,"dummyComponent");i(this,"routerComponent");this.target=t,this.globalStore=new w,this.dummyComponent=new O,this.routerComponent=new S,this.setViews(),this.dispatchInitialRoute()}setViews(){a.setViewTo("/",()=>{this.target.appendChild(this.dummyComponent.container),this.target.appendChild(this.routerComponent.container)}),a.setViewTo("/signin",()=>{this.target.innerHTML="",this.target.textContent="Sign in!"})}dispatchInitialRoute(){const{proxy:t,path:e}=a.splitProxyPath(window.location.pathname);console.log(t,e),a.PROXY_ROOT_PATH=t,a.view(e)}}class S extends g{constructor(){super({classNames:["router-wrapper"]}),this.render()}render(){this.container.innerHTML=`
      <div class="route" data-route="/signin">Go sign in -></div>
    `,new h(this.container.querySelector(".route"))}}class O extends g{constructor(){super({classNames:["dummy-container"]}),this.store.setState("dummy-number",0),this.store.setAction("increaseNumber",({state:t})=>({"dummy-number":t["dummy-number"]+1})),this.render()}render(){const t=this.store.getState("dummy-number");this.container.innerHTML=`
      <span class="dummy-text">main: ${t}</span>
      <button class="dummy-button">click!</button>
    `,this.container.querySelector("button").addEventListener("click",()=>{this.store.dispatch("increaseNumber",{})})}}window.onload=()=>{new E(document.querySelector("#app"))};
