var f=Object.defineProperty;var m=Object.getOwnPropertySymbols;var v=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable;var u=(n,t,e)=>t in n?f(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,p=(n,t)=>{for(var e in t||(t={}))v.call(t,e)&&u(n,e,t[e]);if(m)for(var e of m(t))y.call(t,e)&&u(n,e,t[e]);return n};var i=(n,t,e)=>(u(n,typeof t!="symbol"?t+"":t,e),e);const b=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}};b();class P{constructor(){i(this,"events",{})}subscribe(t,e){return this.events.hasOwnProperty(t)||(this.events[t]=[]),this.events[t].push(e)}publish(t,e={}){return this.events.hasOwnProperty(t)?this.events[t].map(r=>r(e)):[]}}class w{constructor(){i(this,"preventPublish",!1);i(this,"actions");i(this,"eventManager");i(this,"state");this.actions={},this.state={},this.eventManager=new P,this.setStateProxy()}setStateProxy(){const t=(e,r,s)=>(e[r]=s,this.preventPublish||this.eventManager.publish("stateChange",this.state),!0);this.state=new Proxy({},{set:t})}setState(t,e){this.preventPublish=!0,this.state[t]=e,this.preventPublish=!1}setAction(t,e){const r=s=>this.mergeState(e({state:p({},this.state),payload:s}));this.actions[t]=r}dispatch(t,e){if(!this.actions.hasOwnProperty(t))throw Error(`Invalid action type: ${t}.`);this.state=this.actions[t](e)}mergeState(t){return Object.assign(this.state,t)}getState(t){if(!this.state.hasOwnProperty(t))throw Error(`Invalid state key: ${t}.`);return this.state[t]}}class g{constructor({tagName:t,id:e,classNames:r}={}){i(this,"store");i(this,"container");i(this,"id");i(this,"classNames");this.id=e!=null?e:"",this.classNames=r!=null?r:[],this.container=this.createContainer(t!=null?t:"div"),this.store=new w,this.store.eventManager.subscribe("stateChange",()=>this.render())}createContainer(t){const e=document.createElement(t);return e.id=this.id,this.classNames.forEach(r=>{e.classList.add(r)}),e}removeAllChilds(){if(!!this.container)for(;this.container.firstChild;)this.container.removeChild(this.container.firstChild)}render(){throw Error("You must implement render method in component instance.")}}const d=()=>{throw Error("Please set view action to routes.")};class o{static setViewTo(t,e,r=document.getElementById("app")){const s=()=>{r&&(r.innerHTML=""),e()};this.INFO[t].view=s}static view(t){const{path:e}=this.splitProxyPath(t),r=e.replace("/","#");if(console.log("finally render path: ",r),!this.INFO.hasOwnProperty(r)){this.view404();return}this.INFO[r].view()}static splitProxyPath(t){let e="";const r=new RegExp("^\\/proxy\\/\\d+");for(;t.match(r);)e+=t.match(r)[0],t=t.replace(r,"");return{proxy:e,path:t}}static view404(){const t=document.getElementById("app");t.innerHTML="404 Page not found."}}i(o,"ROOT_PATH",""),i(o,"INFO",{"#":{name:"home",view:d},"#signin":{name:"signin",view:d},"#dummy":{name:"dummy",view:d}});const c=class{constructor(t,e="click"){i(this,"targetRoute");this.target=t,this.targetRoute=this.getRouterDataFromElement(this.target),this.target.addEventListener(e,this.execute.bind(this)),this.addGlobalRouterEvents()}addGlobalRouterEvents(){c.globalEventSetted||(c.globalEventSetted=!0,window.addEventListener("popstate",this.renderViewWhenPopState.bind(this)),window.addEventListener("routetrigger",this.renderViewWhenRouteTriggered.bind(this)))}getRouterDataFromElement(t){const e=t.getAttribute("href");if(console.log("href route: ",e," from ",t),e==="")throw Error("Router must be setted html attribute 'href'.");return e}execute(t){t.preventDefault();const e=new CustomEvent("routetrigger",{composed:!0,detail:{href:this.targetRoute}});window.dispatchEvent(e)}renderViewWhenPopState(){let t;window.location.hash.startsWith("##")?t=window.location.hash.replace("#",""):t=window.location.hash,console.log("hash path: ",t,window.location.hash),o.view(t!==""?t:"#")}renderViewWhenRouteTriggered(t){const{href:e}=t.detail;console.log("to pushstate: ",`${o.ROOT_PATH}${e}`),window.history.pushState(null,"",`${o.ROOT_PATH}${e}`),o.view(e)}};let h=c;i(h,"globalEventSetted",!1);class E{constructor(t){i(this,"globalStore");i(this,"dummyComponent");i(this,"routerComponent");this.target=t,console.log("App constructor started!"),console.log("12345".slice(0,5)),this.globalStore=new w,this.dummyComponent=new S,this.routerComponent=new O,this.setViews(),this.dispatchInitialRoute()}setViews(){o.setViewTo("#",()=>{this.target.appendChild(this.dummyComponent.container),this.target.appendChild(this.routerComponent.container)}),o.setViewTo("#signin",()=>{this.target.innerHTML="wow",this.target.innerHTML="<a class='router' href='#dummy'>Dummy!</a>",new h(this.target.querySelector(".router"))}),o.setViewTo("#dummy",()=>{this.target.innerHTML="Dummy reached!"})}dispatchInitialRoute(){const{proxy:t,path:e}=o.splitProxyPath(window.location.pathname);if(console.log("dispatch route: ",t,e),t!=="")o.ROOT_PATH=t;else if(e==="/material-todo-list/"){let s=e.slice(20,e.length).replace("/","#");console.log("render path: ",s),o.ROOT_PATH=s,o.view(s||"#");return}o.view(e)}}class O extends g{constructor(){super({classNames:["router-wrapper"]}),this.render()}render(){this.container.innerHTML=`
      <a class="route" href="#signin">Go sign in -></a>
    `,new h(this.container.querySelector(".route"))}}class S extends g{constructor(){super({classNames:["dummy-container"]}),this.store.setState("dummy-number",0),this.store.setAction("increaseNumber",({state:t})=>({"dummy-number":t["dummy-number"]+1})),this.render()}render(){const t=this.store.getState("dummy-number");this.container.innerHTML=`
      <span class="dummy-text">main: ${t}</span>
      <button class="dummy-button">click!</button>
    `,this.container.querySelector("button").addEventListener("click",()=>{this.store.dispatch("increaseNumber",{})})}}window.onload=()=>{console.log("App started!"),new E(document.querySelector("#app"))};
